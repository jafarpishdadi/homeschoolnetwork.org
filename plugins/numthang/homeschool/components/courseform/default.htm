{%  set courses = courses.courses %}

<div class="row">
	<div class="col-md-6">
		<label>{{ 'Courses'|_ }} </label>
		<div class="btn-group" style="width:100%;">
			<button data-toggle="dropdown" class="btn btn-primary dropdown-toggle" type="button" style="width:100%; text-align:left;">&nbsp; <span class="fa fa-fw" aria-hidden="true">&#xf0f6;</span> {{ 'Select Course'|_ }} <span class="caret"></span></button>
			<ul role="menu" class="dropdown-menu" style="width:100%;">
				<li><a href="/add/course"><span class="fui-new"></span>&nbsp; {{ 'New Course'|_ }}</a></li>
				{% for c in courses %}
				<li><a href="/edit/course/{{ c.id }}" {% if c.template %}style="color:#bbbbbb;"{% endif %}> <span class="fa fa-fw" aria-hidden="true">&#xf0f6;</span>
					{{ 'Course'|_ }} : {{ c.name }} <!--[ {{ c.updated_at|date("m/d/Y") }} ]--></a></li>
				<li class="divider"></li>
				{% endfor %}
			</ul>
		</div>
	</div>
</div>

<form data-request="onSave">
  <input type="hidden" name="user_id" value="{{ user.id }}">
  <div class="row">
    <div class="col-sm-6">
      <div class="form-group {% if errors.first('name') %} has-error {% endif %}">
        <label>ชื่อแผนการศึกษา</label>
        <input type="text" class="form-control" name="name" placeholder="{{ 'Enter course name'|_ }}" value="{{ record.name }}">
        {% if errors.first('name') %}<div class="alert alert-warning" style="margin-top:4px;">{{ errors.first('name') }}</div>{% endif %}
      </div>
    </div>
    <div class="col-sm-6">
      <div class="form-group {% if errors.first('hs_name') %} has-error {% endif %}">
        <label>ชื่อบ้านเรียน</label>
        <input type="text" class="form-control" name="hs_name" placeholder="{{ 'Enter homeschool name'|_ }}" value="{{ record.hs_name }}">
        {% if errors.first('hs_name') %}<div class="alert alert-warning" style="margin-top:4px;">{{ errors.first('hs_name') }}</div>{% endif %}
      </div>
    </div>
  </div>
  <div class="board-inner">
    <div class="accordion">
      <dl>
				<dt><a href="#" class="accordionTitle">0. ปก</a></dt>
        <dd class="accordionItem accordionItemCollapsed">
          <div class="row">
            <div class="col-sm-12">
              <div class="form-group">
                <textarea class="form-control mytinymce" name="cover" placeholder="" rows="36">{% if record.cover is defined %} {{ record.cover }} {% else %} {{ this.page['default_0'] }} {% endif %}</textarea>
              </div>
            </div>
          </div>
        </dd>
        <dt><a class="accordionTitle" href="#">1. ข้อมูลพื้นฐานของครอบครัว</a></dt>
        <dd class="accordionItem accordionItemCollapsed">
          <div class="row">
            <div class="col-sm-4">
              <div class="form-group">
                <label>บิดา</label>
                <input type="text" class="form-control" name="father_name" placeholder="{{ 'Enter father name'|_ }}" value="{{ this.page.father_name }}">
              </div>
            </div>
            <div class="col-sm-8">
              <div class="form-group">
                <label>วุฒิการศึกษา</label>
                <input type="text" class="form-control" name="father_degree" placeholder="{{ 'Enter father degree'|_ }}" value="{{ this.page.father_degree }}">
              </div>
            </div>
            <div class="col-sm-12">
              <div class="form-group">
                <label>ประสบการณ์</label>
                <textarea class="form-control" name="father_exp" placeholder="{{ 'Enter father experience'|_ }}" rows="5">{{ this.page.father_exp }}</textarea>
              </div>
            </div>
            <div class="col-sm-2">
              <div class="form-group">
                <label>อายุ</label>
                <input type="text" class="form-control" name="father_age" placeholder="{{ 'Age'|_ }}" value="{{ this.page.father_age }}">
              </div>
            </div>
            <div class="col-sm-10">
              <div class="form-group">
                <label>อาชีพ</label>
                <input type="text" class="form-control" name="father_job" placeholder="{{ 'Enter father job'|_ }}"  value="{{ this.page.father_job }}">
              </div>
            </div>
            <div class="col-sm-6">
              <div class="form-group">
                <label>ที่อยู่</label>
                <input type="text" class="form-control" name="father_addr" placeholder="{{ 'Enter father address'|_ }}" value="{{ this.page.father_addr }}">
              </div>
            </div>
						<div class="col-sm-6">
							<div class="form-group">
								<label>ติดต่อ</label>
								<input type="text" class="form-control" name="father_contact" placeholder="{{ 'Email address or phone number'|_ }}" value="{{ this.page.father_contact }}">
							</div>
						</div>

            <div class="col-sm-4">
              <div class="form-group">
                <label>มารดา</label>
                <input type="text" class="form-control" name="mother_name" placeholder="{{ 'Enter mother name'|_ }}" value="{{ this.page.mother_name }}">
              </div>
            </div>
            <div class="col-sm-8">
              <div class="form-group">
                <label>วุฒิการศึกษา</label>
                <input type="text" class="form-control" name="mother_degree" placeholder="{{ 'Enter mother degree'|_ }}" value="{{ this.page.mother_degree }}">
              </div>
            </div>
            <div class="col-sm-12">
              <div class="form-group">
                <label>ประสบการณ์</label>
                <textarea class="form-control" name="mother_exp" placeholder="{{ 'Enter mother experience'|_ }}" rows="5">{{ this.page.mother_exp }}</textarea>
              </div>
            </div>
            <div class="col-sm-2">
              <div class="form-group">
                <label>อายุ</label>
                <input type="text" class="form-control" name="mother_age" placeholder="{{ 'Age'|_ }}" value="{{ this.page.mother_age }}">
              </div>
            </div>
            <div class="col-sm-10">
              <div class="form-group">
                <label>อาชีพ</label>
                <input type="text" class="form-control" name="mother_job" placeholder="{{ 'Enter mother job'|_ }}" value="{{ this.page.mother_job }}">
              </div>
            </div>
            <div class="col-sm-6">
              <div class="form-group">
                <label>ที่อยู่</label>
                <input type="text" class="form-control" name="mother_addr" placeholder="{{ 'Enter mother address'|_ }}" value="{{ this.page.mother_addr }}">
              </div>
            </div>
						<div class="col-sm-6">
              <div class="form-group">
                <label>ติดต่อ</label>
                <input type="text" class="form-control" name="mother_contact" placeholder="{{ 'Email address or phone number'|_ }}" value="{{ this.page.mother_contact }}">
              </div>
            </div>
          </div>
        </dd>
        <dt><a href="#" class="accordionTitle">2. ข้อมูลพื้นฐานของผู้เรียน</a></dt>
        <dd class="accordionItem accordionItemCollapsed">
          2.1 ระบุข้อมูลของผู้เรียน
          <div class="row">
            <div class="col-sm-6">
              <div class="form-group">
                <label>ชื่อ-สกุล</label>
                <input type="text" class="form-control" name="student_name" placeholder="{{ 'Enter student name'|_ }}" value="{{ record.student_name }}">
              </div>
            </div>
						<div class="col-sm-3">
							<div class="form-group">
								<label>เพศ</label>
								<select class="form-control select select-primary" data-toggle="select" name="gender">
									<option value="">{{ 'Gender'|_ }}</option>
									<option value="1" {{ record.gender == 1 ? 'selected' : '' }}>{{ 'Male'|_ }}</option>
									<option value="2" {{ record.gender == 2 ? 'selected' : '' }}>{{ 'Female'|_ }}</option>
									<option value="3" {{ record.gender == 3 ? 'selected' : '' }}>{{ 'Other'|_ }}</option>
								</select>
							</div>
						</div>
            <div class="col-sm-3">
              <div class="form-group">
                <label>วัน เดือน ปี เกิด</label>
                <div class="input-group date" data-provide="datepicker">
                  <input type="text" class="form-control" name="birth_date" id="datepicker" value="{% if this.page.birth_date %}{{ this.page.birth_date }}{% else %}{{ "now"|date("d/m/Y") }} {% endif %}">
                    <div class="input-group-addon">
                      <span class="fui-calendar"></span>
                    </div>
                </div>
              </div>
            </div>
					</div>
					<div class="row">
            <div class="col-sm-12">
              <div class="form-group">
                <label>ประวัติการศึกษา (กรณีเรียนในระบบโรงเรียนมาก่อน)</label>
                <textarea class="form-control" name="school_exp" placeholder="{{ 'Enter school experience'|_ }}" rows="5">{{ record.school_exp }}</textarea>
              </div>
            </div>
          </div>
          2.2 พัฒนาการของผู้เรียน (ระบุการพัฒนาการของผู้เรียน/ความสามารถพิเศษ/ความ
    ต้องการพิเศษ)
          <div class="row">
            <div class="col-sm-12">
              <div class="form-group">
                <textarea class="form-control" name="development" placeholder="{{ 'Enter student development'|_ }} พัฒนาการตามวัย, พัฒนาการตามความสามารถพิเศษ หรือ พัฒนาการตามความตองการพิเศษ" rows="10">{{ record.development }}</textarea>
              </div>
            </div>
          </div>
        </dd>
        <dt><a href="#" class="accordionTitle" title="{{ 'Enter student class and reason'|_ }} ระดับชั้น เช่น ประถมศึกษา (ชั้น ป.1 – ป.3) เหตุผลในการจัดการศึกษาของครอบครัว">3. ระดับที่จัดการศึกษา / เหตุผลในการจัดการศึกษาของครอบครัว</a></dt>
        <dd class="accordionItem accordionItemCollapsed">
          <div class="row">
            <div class="col-sm-12">
              <div class="form-group">
                <textarea class="form-control mytinymce" name="class_reason" placeholder="" rows="20">{% if record.class_reason is defined %} {{ record.class_reason }} {% else %} {{ this.page['default_3'] }} {% endif %}</textarea>
              </div>
            </div>
          </div>
        </dd>
        <dt><a href="#" class="accordionTitle">4. จุดมุ่งหมายของการจัดการศึกษา</a></dt>
        <dd class="accordionItem accordionItemCollapsed">
          <div class="row">
          <div class="col-sm-12">
            <div class="form-group">
              <textarea class="form-control mytinymce" name="purpose" placeholder="{{ 'Enter your purpose'|_ }}ระบุความต้องการ เช่น ต้องการพึ่งตนเอง ลดค่าใช้จ่าย เป็นต้น" rows="20">{% if record.purpose is defined %} {{ record.purpose }} {% else %} {{ this.page['default_4'] }} {% endif %}</textarea>
            </div>
          </div>
        </div>
        </dd>
        <dt><a href="#" class="accordionTitle">5. รูปแบบการจัดการศึกษา</a></dt>
        <dd class="accordionItem accordionItemCollapsed">
          <div class="row">
            <div class="col-sm-12">
              <div class="form-group">
                <textarea class="form-control mytinymce" name="format" placeholder="{{ 'Enter your education format'|_ }}5. รูปแบบการจัดการศึกษา" rows="20">{% if record.edu_type is defined %} {{ record.format }} {% else %} {{ this.page['default_5'] }} {% endif %}</textarea>
              </div>
            </div>
          </div>
        </dd>
        <dt><a href="#" class="accordionTitle">6. โครงสร้างเวลาเรียน</a></dt>
        <dd class="accordionItem accordionItemCollapsed">
          <div class="row">
            <div class="col-sm-12">
              <div class="form-group">
								<textarea class="form-control mytinymce" name="schedule" placeholder="" rows="20">{% if record.schedule is defined %} {{ record.schedule }} {% else %} {{ this.page['default_6'] }} {% endif %}</textarea>
                <!--<textarea class="form-control" name="schedule" placeholder="กลุ่มประสบการณ์ /กลุ่มสาระการเรียนรู้ (ตามตารางในข้อ 7)" rows="20">{% if record.schedule is defined %} {{ record.schedule }} {% else %} {% endif %}</textarea>-->
              </div>
            </div>
          </div>
        </dd>
        <dt><a href="#" class="accordionTitle">7. การจัดกลุ่มสาระการเรียนรู้ /กลุ่มประสบการณ์</a></dt>
        <dd class="accordionItem accordionItemCollapsed">
          <div class="row">
            <div class="col-sm-12">
              <div class="form-group">
                <textarea class="form-control mytinymce" name="curriculum" placeholder="" rows="20">{% if record.curriculum is defined %} {{ record.curriculum }} {% else %} {{ this.page['default_7'] }} {% endif %}</textarea>
              </div>
            </div>
          </div>
        </dd>
        <dt><a href="#" class="accordionTitle">8. การจัดกิจกรรมพัฒนาผู้เรียน</a></dt>
        <dd class="accordionItem accordionItemCollapsed">
          <div class="row">
            <div class="col-sm-12">
              <div class="form-group">
                <textarea class="form-control mytinymce" name="activity" placeholder="" rows="20">{% if record.activity is defined %} {{ record.activity }} {% else %} {{ this.page['default_8'] }} {% endif %}</textarea>
              </div>
            </div>
          </div>
        </dd>
        <dt><a href="#" class="accordionTitle">9. การจัดกระบวนการเรียนรู้</a></dt>
        <dd class="accordionItem accordionItemCollapsed">
          <div class="row">
            <div class="col-sm-12">
              <div class="form-group">
                <textarea class="form-control mytinymce" name="learning" placeholder="" rows="20">{% if record.learning is defined %} {{ record.learning }} {% else %} {{ this.page['default_9'] }} {% endif %}</textarea>
              </div>
            </div>
          </div>
        </dd>
        <dt><a href="#" class="accordionTitle">10. การวัดและประเมินผลการเรียนรู้</a></dt>
        <dd class="accordionItem accordionItemCollapsed">
          <div class="row">
            <div class="col-sm-12">
              <div class="form-group">
                <textarea class="form-control mytinymce" name="evaluate" placeholder="" rows="20">{% if record.evaluate is defined %} {{ record.evaluate }} {% else %} {{ this.page['default_10'] }} {% endif %}</textarea>
              </div>
            </div>
          </div>
        </dd>
        <dt><a href="#" class="accordionTitle">11. อื่นๆ (ครอบครัวสามารถเพิ่มเติมรายละเอียดที่เห็นว่าเป็นประโยชน์ต่อผู้เรียนได้)</a></dt>
        <dd class="accordionItem accordionItemCollapsed">
          <div class="row">
            <div class="col-sm-12">
              <div class="form-group">
                <textarea class="form-control mytinymce" name="other" placeholder="" rows="20">{{ record.other }}</textarea>
              </div>
            </div>
          </div>
        </dd>
      </dl>
    </div>
    <div class="clearfix"></div>
  </div>
  <div class="row">
    <div class="col-sm-12">
    	<input type="hidden" name="save_as" value="0">
			<!--เฉพาะ admin จะ save ได้ทุกครั้ง หรือ ถ้าเป็นการเขียนแผนใหม่ หรือ การแก้ไขแผนและเป็นแผนตัวเองเท่านั้น-->
			{% if (can('edit_course_template') or (record.id is not defined and record.template == 0) or (record.id is defined and record.template == 0 and record.user_id == user.id))  %}
    		<div class="col-sm-2">
					<button type="submit" class="btn btn-lg btn-default btn-block" data-hotkey="ctrl+s, cmd+s">{{ 'Save'|_ }}</button>
				</div>
				<button type="submit" title="{{ 'Save'|_ }}" class="btn btn-lg btn-default fa fa-save float" data-hotkey="ctrl+s, cmd+s"></button>
    	{% endif %}
    	{% if record.id is defined %}
				<button type="button" title="{{ 'Preview'|_ }}" class="btn btn-lg btn-info fa fa-eye float2" onClick="window.open('/course/{{ record.created_at| date('U') }}', '_blank');"></button>
				<div class="col-sm-3">
			    <button type="submit" class="btn btn-lg btn-info btn-block" onClick="if(confirm('{{ 'Save as'|_ }} '+this.form.name.value)) this.form.save_as.value = 1; else return false;">{{ 'Save as'|_ }} ...</button>
				</div>
				<div class="col-sm-2">
					<button type="button" class="btn btn-lg btn-info btn-block" onClick="window.open('/course/{{ record.created_at|date('U') }}', '_blank');">{{ 'Preview'|_ }} </button>
				</div>
				<div class="col-sm-3">
					<button type="button" class="btn btn-lg btn-info btn-block" onClick="window.open('/course/{{ record.created_at|date('U') }}?print=1', '_blank');">{{ 'Print to PDF'|_ }} </button>
				</div>
				{% if (can('edit_course_template') or (record.template == 0 and record.id is not defined) or (record.template == 0 and record.user_id == user.id and record.id is defined))  %}
					<div class="col-sm-2">
				  	<button type="button" data-request="onDelete" data-request-confirm="Are you sure?" class="btn btn-lg btn-danger btn-block">{{ 'Remove'|_ }}</button>
					</div>
		    {% endif %}
	    {% endif %}
    </div>
  </div>
  <br>
</form>
{% put scripts %}
	<script src="{{ ['assets/js/accordion.js']|theme }}"></script>
	<script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
	<link id="bsdp-css" href="https://uxsolutions.github.io/bootstrap-datepicker/bootstrap-datepicker/css/bootstrap-datepicker3.min.css" rel="stylesheet">
	<script src="https://uxsolutions.github.io/bootstrap-datepicker/bootstrap-datepicker/js/bootstrap-datepicker.min.js"></script>
	<script type="text/javascript">
		$.fn.datepicker.defaults.format = "dd/mm/yyyy";
	</script>
	<script src="//cdn.tinymce.com/4/tinymce.min.js"></script>
	<script>
		var editor_config = {
			selector: "textarea.mytinymce",
			path_absolute : "/",
			setup : function(mytinymce) {
				mytinymce.on('init', function() {
          this.getDoc().body.style.fontSize = '18px';
          this.getDoc().body.style.fontFamily = 'Arial, Tahoma, Sarabun';
        });
				mytinymce.on('keydown', function(event) {
	       if (event.keyCode == 9) { // tab pressed
	          if (event.shiftKey) {
	            mytinymce.execCommand('Outdent');
	          }
	          else {
	            mytinymce.execCommand('Indent');
	          }
	          event.preventDefault();
	          return false;
	        }
		    });
	    },
			plugins: [
				"advlist autolink lists link image imagetools charmap print preview hr anchor pagebreak",
				"searchreplace wordcount visualblocks visualchars code fullscreen",
				"insertdatetime media nonbreaking save table contextmenu directionality",
				"emoticons template paste textcolor colorpicker textpattern"
			],
			toolbar: "copy paste pastetext cut | fontsizeselect forecolor | blockquote bold italic underline | alignleft aligncenter alignright | bullist numlist indent outdent table | image media link | removeformat",
			templates: [
				{title: 'Some title 1', description: 'Some desc 1', content: 'My content'},
				{title: 'Some title 2', description: 'Some desc 2', url: 'development.html'}
			],
			contextmenu: "copy cut paste pastetext | link image | cell row column deletetable",
			relative_urls: false,
			force_br_newlines : true,
			force_p_newlines : false,
			paste_as_text: false,
			forced_root_block : 'div',
			file_browser_callback : function(field_name, url, type, win) {
				var x = window.innerWidth || document.documentElement.clientWidth || document.getElementsByTagName('body')[0].clientWidth;
				var y = window.innerHeight|| document.documentElement.clientHeight|| document.getElementsByTagName('body')[0].clientHeight;

				var cmsURL = editor_config.path_absolute + 'lfm?field_name=' + field_name;
				if (type == 'image') {
					cmsURL = cmsURL + "&type=Images";
				} else {
					cmsURL = cmsURL + "&type=Files";
				}

				tinyMCE.activeEditor.windowManager.open({
					file : cmsURL,
					title : 'Filemanager',
					width : x * 0.8,
					height : y * 0.8,
					resizable : "yes",
					close_previous : "no"
				});
			}
		};
		tinymce.init(editor_config);
	</script>
{% endput %}
