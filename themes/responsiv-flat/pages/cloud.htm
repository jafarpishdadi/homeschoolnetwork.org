title = "Cloud homeschooling"
url = "/cloud"
layout = "default"
is_hidden = 0
robot_index = "index"
robot_follow = "follow"

[blogTags]
hideOrphans = 1
results = 0
orderBy = 0
direction = "desc"
==
<?php
function onLoadHomschooler()
{
  use October\Rain\Auth\Models\User;
  use RainLab\Location\Models\State;

  $code = post('value');
  $code = str_replace('TH-', '', $code);
  $state = new State();
  $query = $state->where('code', '=', $code)->get();

  $user = new User();
  $users = $user->where('state_id', '=', $query[0]->id)->get();
  #echo $users[0]->name;
  #dump($users);
  $listed = '';
  foreach ($users as $key=>$value) {
    $listed .= '
      <div class="col-xl-1 col-md-2 col-sm-3 col-xs-4">
        <div class="text-center">
          <img class="center-block" src="https://graph.facebook.com/'.$users[$key]->facebook.'/picture?type=small" title="'.$users[$key]->name.'" style="cursor:pointer; border-radius: 100px; height:85px; padding-bottom:5px;" onClick="window.location.href = \'https://fb.com/'.$users[$key]->facebook.'\';">
          <div class="text-muted small" style="white-space: nowrap;">
           '.$users[$key]->name.' &nbsp;
          </div>
        </div>
      </div>';
    #if(!$key%6)
    #  $listed .= '<div class="clearfix"></div>';
  }
  return $listed;
}
function onStart() {
  $this->page['population'] = html_entity_decode('"TH-57" : 16.63');
  #return $population;

}
?>
==
<link rel="stylesheet" href="{{ 'assets/css/jquery-jvectormap-2.0.3.css'|theme }}" type="text/css" media="screen"/>

{% put scripts %}
<script src="{{ 'assets/js/jquery-jvectormap-2.0.3.min.js'|theme }}"></script>
<script src="{{ 'assets/js/jquery-jvectormap-th-mill.js'|theme }}"></script>
<script>
  //var str = {{ this.page.population }};
  //str.replace("&quote;", "\"");
  var hsData = { {{ this.page.population }} };
  $('#map').vectorMap({
    map: 'th_mill',
    series: {
      regions: [{
        values: hsData,
        scale: ['#C8EEFF', '#0071A4'],
      }]
    },
    onRegionClick: function(event, code) {
      $.request('onLoadHomschooler', {
        data: { value: code },
        success: function(data) {
          this.success(data).done(function() {
            document.getElementById('result').innerHTML = data.result;
          });
        }
      });

    },
    onRegionTipShow: function(e, el, code) {
      el.html(el.html()+' (Population - '+hsData[code]+')');
    },
    backgroundColor: '#eee',

  });
</script>
{% endput %}

<section id="layout-title">
    <div class="container">
        <h3>{{ 'Cloud homeschooling'|_ }}</h3>
    </div>
</section>

<div class="container">
  <div class="row">
    <div class="col-sm-4">
      <div id="map" style="width: 100%; height: 700px"></div>
    </div>
    <div class="col-sm-8">
      <div class="row">
        <div id="result">
        </div>
      </div>
    </div>
  </div>
</div>
